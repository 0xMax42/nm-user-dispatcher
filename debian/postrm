#!/bin/bash
set -e

# Automatically added by dh_installsystemduser
if [ "$1" = "purge" ]; then
	if [ -z "$DPKG_ROOT" ] && [ -x "/usr/bin/deb-systemd-helper" ]; then
		deb-systemd-helper --user purge 'nm-user-dispatcher.service' >/dev/null || true
		# Reload systemd user units for all users
		deb-systemd-invoke --user --no-dbus daemon-reload >/dev/null || true
	fi
fi
# End automatically added section

###############################################################################
# Custom global disable/stop on purge
###############################################################################
if [ "$1" = "purge" ] && [ -z "$DPKG_ROOT" ]; then
	if command -v systemctl >/dev/null 2>&1; then
		echo "Disabling nm-user-dispatcher.service globally..."
		systemctl disable --global nm-user-dispatcher.service >/dev/null 2>&1 || true
		echo "Stopping nm-user-dispatcher.service for all users..."
		systemctl stop --global nm-user-dispatcher.service >/dev/null 2>&1 || true
	fi
fi

exit 0
